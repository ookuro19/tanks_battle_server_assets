# 问题解决方案

## 1. Cell Entitycall

### 1. cell entitycall储存后会由于负载均衡丢失的问题

**解决方案**：

~~(弃用) 将所有原先在cell上储存entitycall的逻辑转移到base上~~
逻辑依旧放在cell上，通知部分则调用base即可

## 2. Progress

### 1. 由于cell entitycall丢失的问题导致的加载完成等问题

**解决方案**：

1. 由于需要通知其他玩家，所以其flag需要在cell上，选择All clients或other clients，故客户端要更新progress依旧只能使用cellcall

2. 由于需要通知所有客户端完成刷新，但cell entitycall储存问题，故加载完成后需要通知base来实现加载完成回调

3. 具体流程为：

```sequence {theme="simple"}
client -> Avatar_Cell : update progress
Avatar_Cell -> Avatar_Cell : check progress == 100
Avatar_Cell -> Room_Base : AvatarLoadingFinish
Room_Base -> Room_Base : check all avatar loading finish
Room_Base -> Avatar_Base : loading finish
Room_Base -> Room_Cell : start timer
```

### 3. MatchingFinish在玩家enter world之前

**原因分析**：

从函数逻辑上看，room统计出房间内玩家数目为8人时便会发送matching finish，此时最后一个进入的玩家还未创建cell部分，但只有等最后一名玩家创建cell后才执行enter world，故matching finish一定在enter world之前，故发生此问题。

**解决方案**：

1. 需要分析cell init，onGetCell，onEnterWorld的执行先后顺序，进而调整

2. 根据分析得出的先后顺序将enterroom放在其之后

### 4. Destination

1. 逻辑相应位置
**原因分析**：是否需要将相应机制改为allclients等形式
**解决方案**：否，因为涉及到倒计时等相应机制

2. 计时相应位置
**原因分析**：玩家到达终点时需要通知到达时间
**解决方案**：若倒计时位于cell上，则还需要从cell上取得相应时间

**最终解决方案**： 由于逻辑还在cell上，故此问题不再是问题